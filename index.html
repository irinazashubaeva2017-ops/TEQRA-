<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TEQRA :: SYSTEM</title>

<style>
/* ================= CORE ================= */
*{margin:0;padding:0;box-sizing:border-box;user-select:none}
html,body{
  width:100%;height:100%;
  background:#000;
  color:#eaeaea;
  font-family:"Courier New",monospace;
  overflow:hidden;
}

/* ================= MATRIX ================= */
canvas{
  position:fixed;
  inset:0;
  z-index:0;
}

/* ================= SCREENS ================= */
.screen{
  position:fixed;
  inset:0;
  z-index:5;
  display:flex;
  justify-content:center;
  align-items:center;
  opacity:0;
  pointer-events:none;
  transition:opacity 1s;
}
.screen.active{
  opacity:1;
  pointer-events:auto;
}

/* ================= PANELS ================= */
.panel{
  max-width:720px;
  padding:28px;
  text-align:center;
}
.line{
  margin:16px 0;
  font-size:18px;
  opacity:0;
  transform:translateY(10px);
  transition:.8s;
}
.line.show{opacity:1;transform:none}

.glitch{
  animation:glitch 1.5s infinite;
}
@keyframes glitch{
  0%{text-shadow:none}
  40%{text-shadow:-2px 0 red,2px 0 cyan}
  80%{text-shadow:2px 0 red,-2px 0 cyan}
}

/* ================= CHOICE ================= */
.choice{
  border:2px solid;
  padding:18px;
  margin:18px 0;
  cursor:pointer;
  transition:.3s;
}
.choice:hover{background:rgba(255,255,255,.06)}

/* ================= HUD ================= */
#hud{
  position:fixed;
  top:14px;
  left:50%;
  transform:translateX(-50%);
  z-index:10;
  font-size:16px;
  letter-spacing:2px;
}

/* ================= FRACTURES ================= */
.fracture{
  position:fixed;
  width:70px;height:70px;
  border:2px solid #ff4d4d;
  box-shadow:0 0 18px #ff4d4d;
  animation:pulse 1.1s infinite;
  z-index:8;
}
.false{border-color:#666;box-shadow:none}
@keyframes pulse{
  0%{transform:scale(.9);opacity:.6}
  50%{transform:scale(1.1);opacity:1}
}

/* ================= CHAOS ================= */
body.chaos{
  animation:shake .15s infinite;
}
@keyframes shake{
  0%{transform:translate(0,0)}
  25%{transform:translate(2px,-2px)}
  50%{transform:translate(-2px,2px)}
}

/* ================= BUTTON ================= */
#hold{
  margin-top:26px;
  padding:22px;
  border:2px solid #ffb86b;
  color:#ffb86b;
  font-size:22px;
  letter-spacing:5px;
}
</style>
</head>

<body>

<canvas id="matrix"></canvas>
<div id="hud"></div>

<!-- PROLOGUE -->
<div id="prologue" class="screen active">
  <div class="panel">
    <div class="line show">СИСТЕМА ЗРУЙНОВАНА.</div>
    <div class="line show">НЕ ЗОВНІ — ВСЕРЕДИНІ.</div>
    <div class="line show glitch">ЛЮДСТВО ПЕРЕТВОРЕНО НА КОД.</div>
    <div class="line show">ПОТРІБЕН ХРАНИТЕЛЬ.</div>
  </div>
</div>

<!-- CHOICE -->
<div id="choice" class="screen">
  <div class="panel">
    <div class="line show">ОБЕРИ СВОЮ ФУНКЦІЮ.</div>

    <div class="choice" style="border-color:#ffb86b;color:#ffb86b"
      onclick="startGame('foundation')">
      ФУНДАМЕНТ // УТРИМАННЯ
    </div>

    <div class="choice" style="border-color:#66d9ff;color:#66d9ff"
      onclick="startGame('architect')">
      АРХІТЕКТОР // СТРУКТУРА
    </div>

    <div class="choice" style="border-color:#c792ea;color:#c792ea"
      onclick="startGame('resonance')">
      РЕЗОНАНС // ЗВʼЯЗОК
    </div>
  </div>
</div>

<!-- GAME -->
<div id="game" class="screen">
  <div class="panel">
    <div class="line show" id="title"></div>
    <div class="line show" id="desc"></div>
    <div class="line glitch">РОЗПАД: <span id="entropy">100</span>%</div>
    <div class="line glitch" id="sys"></div>
    <div id="hold">СИСТЕМА ПРАЦЮЄ</div>
  </div>
</div>

<script>
/* ================= MATRIX ================= */
const c=document.getElementById("matrix"),x=c.getContext("2d");
let w,h,cols;
function resize(){
  w=c.width=innerWidth;
  h=c.height=innerHeight;
  cols=Math.floor(w/16);
}
resize();onresize=resize;
let drops=Array(cols).fill(0);
function matrix(){
  x.fillStyle="rgba(0,0,0,.35)";
  x.fillRect(0,0,w,h);
  x.fillStyle="#00ff9c";
  x.font="16px monospace";
  drops.forEach((y,i)=>{
    x.fillText(Math.random()>0.5?"1":"0",i*16,y*16);
    if(y*16>h||Math.random()>.97)drops[i]=0;
    drops[i]++;
  });
  requestAnimationFrame(matrix);
}
matrix();

/* ================= FLOW ================= */
setTimeout(()=>{
  prologue.classList.remove("active");
  choice.classList.add("active");
},5500);

let entropy=100;
let mode="";
let fractures=[];

function startGame(m){
  mode=m;
  choice.classList.remove("active");
  game.classList.add("active");
  title.textContent =
    m==="foundation"?"ФУНДАМЕНТ":
    m==="architect"?"АРХІТЕКТОР":"РЕЗОНАНС";
  desc.textContent =
    m==="foundation"?"Утримуй систему від розпаду.":
    m==="architect"?"Перебудуй логіку вузлів.":
    "Віднови звʼязки між фрагментами.";
  gameLoop();
}

function spawnFracture(){
  const f=document.createElement("div");
  f.className="fracture "+(Math.random()<0.35?"false":"");
  f.style.top=Math.random()*80+"%";
  f.style.left=Math.random()*80+"%";
  f.onclick=()=>{
    if(!f.classList.contains("false")){
      entropy-=6;
      f.remove();
    }else{
      f.style.top=Math.random()*80+"%";
      f.style.left=Math.random()*80+"%";
    }
  };
  document.body.appendChild(f);
  fractures.push(f);
}

function gameLoop(){
  setInterval(()=>{
    entropy+=fractures.length*0.4;
    entropy=Math.max(0,Math.min(100,entropy));
    entropySpan.textContent=Math.floor(entropy);

    if(entropy>80){
      sys.textContent="СИСТЕМА ВТРАЧАЄ ФОРМУ.";
      document.body.classList.add("chaos");
      if(Math.random()<0.06)spawnFracture();
    }else if(entropy>40){
      sys.textContent="ДЕГРАДАЦІЯ СПОВІЛЬНЕНА.";
      document.body.classList.remove("chaos");
      if(Math.random()<0.04)spawnFracture();
    }else{
      sys.textContent="СТАБІЛІЗАЦІЯ ДОСЯГНУТА.";
      document.body.classList.remove("chaos");
    }
  },120);
}
</script>

</body>
</html>

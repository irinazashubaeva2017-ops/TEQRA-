<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>TEQRA</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;user-select:none}
html,body{width:100%;height:100%;background:#000;color:#eaeaea;font-family:Courier New,monospace;overflow:hidden}

:root{
--green:#00ff9c;
--red:#ff4d4d;
--gold:#ffb86b;
}

canvas{position:fixed;inset:0;z-index:1}

.screen{
position:fixed;inset:0;z-index:3;
display:flex;justify-content:center;align-items:center;
opacity:0;pointer-events:none;transition:1s;
}
.screen.active{opacity:1;pointer-events:auto}

.panel{max-width:760px;padding:24px;text-align:center}
.line{margin:14px 0;font-size:18px}
.glitch{animation:glitch 1.2s infinite}
@keyframes glitch{
50%{text-shadow:-2px 0 red,2px 0 cyan}
}

#hud{
position:fixed;top:10px;left:50%;
transform:translateX(-50%);
z-index:6;font-size:18px;color:var(--red);
}

#controls{
position:fixed;top:10px;right:10px;z-index:6;
}
.btn{
border:1px solid #555;color:#aaa;
padding:6px 10px;margin-left:6px;
cursor:pointer;font-size:12px;
}
.btn:hover{background:#111}

.fracture{
position:fixed;width:90px;height:90px;
background:#000;border:2px solid var(--red);
box-shadow:0 0 25px var(--red);
z-index:5;animation:pulse 1s infinite;
}
.false{border-style:dashed;opacity:.6}

@keyframes pulse{
50%{transform:scale(1.1)}
}

body.chaos{animation:shake .12s infinite}
@keyframes shake{
25%{transform:translate(2px,-2px)}
50%{transform:translate(-2px,2px)}
}
</style>
</head>

<body>

<canvas id="matrix"></canvas>
<div id="hud">РОЗПАД: 100%</div>

<div id="controls">
  <span class="btn" onclick="togglePause()">ПАУЗА</span>
  <span class="btn" onclick="resetGame()">СКИНУТИ</span>
</div>

<div id="prologue" class="screen active">
  <div class="panel">
    <div class="line">СИСТЕМА ТРІЩИТЬ.</div>
    <div class="line glitch">ФУНДАМЕНТ ВТРАТИВ ФОРМУ.</div>
    <div class="line">ОБЕРИ ШЛЯХ.</div>
  </div>
</div>

<div id="choice" class="screen">
  <div class="panel">
    <div class="line">ФУНДАМЕНТ // СТІЙКІСТЬ</div>
    <div class="btn" onclick="startFoundation()">ПОЧАТИ</div>
  </div>
</div>

<div id="foundation" class="screen">
  <div class="panel">
    <div class="line" style="color:var(--gold)">ГЛАВА I — ФУНДАМЕНТ</div>
    <div class="line">ТИ НЕ ВИПРАВЛЯЄШ.</div>
    <div class="line">ТИ УТРИМУЄШ СТРУКТУРУ.</div>
    <div class="line glitch" id="status"></div>
  </div>
</div>

<script>
/* ===== MATRIX ===== */
const c=document.getElementById("matrix"),x=c.getContext("2d");
let w,h,cols,paused=false;
function resize(){w=c.width=innerWidth;h=c.height=innerHeight;cols=Math.floor(w/16)}
resize();onresize=resize;
let drops=Array(cols).fill(0);
function matrix(){
if(paused) return requestAnimationFrame(matrix);
x.fillStyle="rgba(0,0,0,.35)";
x.fillRect(0,0,w,h);
x.fillStyle="#00ff9c";
x.font="16px monospace";
drops.forEach((y,i)=>{
x.fillText(Math.random()>.5?"1":"0",i*16,y*16);
if(y*16>h||Math.random()>.96)drops[i]=0;
drops[i]++;
});
requestAnimationFrame(matrix);
}
matrix();

/* ===== FLOW ===== */
setTimeout(()=>{
prologue.classList.remove("active");
choice.classList.add("active");
},4000);

/* ===== GAME STATE ===== */
let entropy=100;
let fractures=[];
let loop=null;

function save(){
localStorage.setItem("teqra_save",JSON.stringify({entropy}));
}

function load(){
const s=localStorage.getItem("teqra_save");
if(s) entropy=JSON.parse(s).entropy;
}

function updateHUD(){
entropy=Math.max(0,Math.min(100,entropy));
hud.textContent="РОЗПАД: "+entropy+"%";
save();
}

function spawnFracture(forceReal=false){
const f=document.createElement("div");
f.className="fracture";
if(!forceReal && Math.random()<0.4) f.classList.add("false");
f.style.top=Math.random()*70+"%";
f.style.left=Math.random()*70+"%";

f.onclick=()=>{
if(paused) return;
if(f.classList.contains("false")){
f.style.top=Math.random()*70+"%";
f.style.left=Math.random()*70+"%";
entropy+=2;
}else{
entropy-=10;
f.remove();
fractures=fractures.filter(x=>x!==f);
}
updateHUD();
};

document.body.appendChild(f);
fractures.push(f);
}

function ensureRealFracture(){
if(!fractures.some(f=>!f.classList.contains("false")))
spawnFracture(true);
}

function startFoundation(){
choice.classList.remove("active");
foundation.classList.add("active");
load();updateHUD();

loop=setInterval(()=>{
if(paused) return;

entropy+=fractures.length*0.4;
ensureRealFracture();

if(Math.random()<0.6 && fractures.length<8) spawnFracture();

if(entropy>75){
status.textContent="СТРУКТУРА РОЗПАДАЄТЬСЯ.";
document.body.classList.add("chaos");
}else{
status.textContent="";
document.body.classList.remove("chaos");
}

if(entropy<=0){
status.textContent="ФУНДАМЕНТ УТРИМАНО.";
clearInterval(loop);
fractures.forEach(f=>f.remove());
}
updateHUD();
},450);
}

function togglePause(){
paused=!paused;
status.textContent=paused?"ПАУЗА":"";
}

function resetGame(){
localStorage.removeItem("teqra_save");
location.reload();
}
</script>

</body>
</html>

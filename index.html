<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TEQRA | Genesis</title>
    <style>
        /* --- ФІЗИКА СВІТУ 3036 --- */
        :root {
            --void: #020204;
            --core-black: #000000;
            --light-stable: 180, 255, 230;   /* Живе ціанове */
            --light-dying: 255, 60, 60;      /* Криваво-червоне */
            --light-hope: 255, 200, 100;     /* Тепле золоте (фундамент) */
            
            --anim-pulse-fast: 0.8s;
            --anim-pulse-slow: 4s;
        }

        * {
            margin: 0; padding: 0; box-sizing: border-box;
            user-select: none; -webkit-tap-highlight-color: transparent;
            cursor: none; /* У майбутньому курсорів немає */
        }

        body {
            background-color: var(--void);
            height: 100vh; overflow: hidden;
            display: flex; justify-content: center; align-items: center;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            color: rgba(255,255,255,0.8);
            perspective: 1000px;
        }

        /* --- ШАР 0: КОСМІЧНИЙ ПИЛ (CANVAS) --- */
        #dust-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; opacity: 0.4; mix-blend-mode: screen;
        }

        /* --- ШАР 1: ЖИВЕ СВІТЛО (NEBULA) --- */
        .ambient-nebula {
            position: fixed; top: 50%; left: 50%;
            width: 150vmax; height: 150vmax;
            background: radial-gradient(circle, rgba(var(--light-dying), 0.15), transparent 60%);
            transform: translate(-50%, -50%);
            z-index: 1;
            animation: breathe-anxiety 5s infinite ease-in-out alternate;
            transition: background 3s ease;
        }

        /* --- ШАР 2: ПОШКОДЖЕННЯ РЕАЛЬНОСТІ --- */
        .reality-glitch {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 100; pointer-events: none;
            box-shadow: inset 0 0 100px rgba(0,0,0,0.8);
            mix-blend-mode: overlay;
            opacity: 0;
        }
        
        /* Ефект розлому (активується JS) */
        body.broken .reality-glitch {
            animation: glitch-flash 4s infinite random;
            opacity: 0.3;
        }

        /* --- ШАР 3: ЯДРО (СИНГУЛЯРНІСТЬ) --- */
        .singularity-wrapper {
            position: relative;
            z-index: 10;
            display: flex; justify-content: center; align-items: center;
            width: 300px; height: 300px;
        }

        /* Горизонт подій (Спотворення) */
        .event-horizon {
            position: absolute;
            width: 100%; height: 100%;
            border-radius: 50%;
            /* Ефект лінзи */
            backdrop-filter: blur(4px) contrast(1.5);
            -webkit-backdrop-filter: blur(4px) contrast(1.5);
            box-shadow: inset 0 0 80px rgba(0,0,0,0.9);
            border: 1px solid rgba(255,255,255,0.05);
            animation: distort-space 10s infinite linear;
        }

        /* Саме Ядро */
        .the-core {
            position: relative;
            width: 140px; height: 140px;
            background: var(--core-black);
            border-radius: 50%;
            /* Світіння з-під чорного */
            box-shadow: 0 0 60px rgba(var(--light-dying), 0.6);
            z-index: 20;
            transition: all 1s cubic-bezier(0.25, 1, 0.5, 1);
            animation: heartbeat-panic 1.2s infinite ease-in-out;
        }

        /* Акреційний диск (Тонке кільце) */
        .the-core::after {
            content: ''; position: absolute;
            top: -5px; left: -5px; right: -5px; bottom: -5px;
            border-radius: 50%;
            border: 1px solid rgba(var(--light-dying), 0.8);
            opacity: 0.7;
            filter: blur(2px);
            animation: spin-chaos 20s infinite linear;
        }

        /* --- ШАР 4: ХРАНИТЕЛІ (ОРБІТИ) --- */
        .orbit-container {
            position: absolute; width: 100%; height: 100%;
            pointer-events: none; opacity: 0; transition: opacity 2s ease;
        }

        .guardian-node {
            position: absolute;
            width: 50px; height: 50px;
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            pointer-events: auto;
            transition: transform 0.6s ease;
            mix-blend-mode: screen;
        }

        /* Візуал вузла */
        .guardian-node::before {
            content: ''; width: 8px; height: 8px; background: currentColor;
            border-radius: 50%; box-shadow: 0 0 20px currentColor;
            transition: all 0.4s;
        }
        
        /* Позиції */
        .node-foundation { top: 0; left: 50%; transform: translate(-50%, -50%); color: rgb(255, 160, 50); }
        .node-architecture { bottom: 15%; left: 15%; transform: translate(-50%, 50%); color: rgb(0, 240, 255); }
        .node-resonance { bottom: 15%; right: 15%; transform: translate(50%, 50%); color: rgb(255, 50, 220); }

        /* Реакція на дотик */
        .guardian-node.active::before { width: 100%; height: 100%; opacity: 0.2; }
        .guardian-node.active { transform: scale(1.5) !important; }

        /* --- ШАР 5: ДУМКИ (ТЕКСТ) --- */
        .mind-stream {
            position: fixed; bottom: 15%; width: 100%;
            text-align: center;
            font-size: 0.9rem; letter-spacing: 0.3em;
            color: rgba(255,255,255,0.6);
            opacity: 0;
            transform: translateY(10px);
            transition: all 1s ease;
            mix-blend-mode: difference;
            pointer-events: none;
            font-weight: 300;
        }

        /* --- АНІМАЦІЇ --- */
        
        /* Дихання тривоги (червоне світло) */
        @keyframes breathe-anxiety {
            0% { opacity: 0.3; transform: translate(-50%, -50%) scale(1); }
            100% { opacity: 0.6; transform: translate(-50%, -50%) scale(1.1); }
        }

        /* Дихання спокою (блакитне світло) */
        @keyframes breathe-calm {
            0% { opacity: 0.2; transform: translate(-50%, -50%) scale(1); }
            50% { opacity: 0.3; transform: translate(-50%, -50%) scale(1.05); }
            100% { opacity: 0.2; transform: translate(-50%, -50%) scale(1); }
        }

        /* Биття серця (Ядро) */
        @keyframes heartbeat-panic {
            0% { transform: scale(1); box-shadow: 0 0 50px rgba(var(--light-dying), 0.5); }
            15% { transform: scale(1.05); box-shadow: 0 0 90px rgba(var(--light-dying), 0.8); }
            30% { transform: scale(1); box-shadow: 0 0 50px rgba(var(--light-dying), 0.5); }
            100% { transform: scale(1); }
        }

        @keyframes heartbeat-calm {
            0%, 100% { transform: scale(1); box-shadow: 0 0 60px rgba(var(--light-stable), 0.3); }
            50% { transform: scale(1.02); box-shadow: 0 0 80px rgba(var(--light-stable), 0.5); }
        }

        /* Спотворення простору */
        @keyframes distort-space {
            0% { border-radius: 50%; transform: rotate(0deg); }
            33% { border-radius: 45% 55% 50% 50%; }
            66% { border-radius: 50% 50% 45% 55%; }
            100% { border-radius: 50%; transform: rotate(360deg); }
        }

        /* Глітч реальності */
        @keyframes glitch-flash {
            0%, 95% { opacity: 0; transform: translateX(0); }
            96% { opacity: 0.2; transform: translateX(-5px); filter: hue-rotate(90deg); }
            97% { opacity: 0; transform: translateX(0); }
            98% { opacity: 0.3; transform: translateX(5px); filter: hue-rotate(-90deg); }
            100% { opacity: 0; }
        }

        /* Ефект дотику (Ripple) */
        .ripple {
            position: absolute; border: 1px solid rgba(255,255,255,0.3);
            border-radius: 50%; animation: ripple-expand 1.5s ease-out forwards;
            pointer-events: none; z-index: 50;
        }
        @keyframes ripple-expand { to { transform: scale(5); opacity: 0; border-width: 0; } }

    </style>
</head>
<body class="broken">

    <div class="reality-glitch"></div>
    <div class="ambient-nebula" id="ambient"></div>
    <canvas id="dust-layer"></canvas>

    <div class="singularity-wrapper" id="world-center">
        <div class="event-horizon"></div>
        <div class="the-core" id="core"></div>

        <div class="orbit-container" id="orbits">
            <div class="guardian-node node-foundation" data-role="foundation"></div>
            <div class="guardian-node node-architecture" data-role="architecture"></div>
            <div class="guardian-node node-resonance" data-role="resonance"></div>
        </div>
    </div>

    <div class="mind-stream" id="thought-display"></div>

    <script>
        // --- 1. СИСТЕМА ДУМОК (НАРАТИВ) ---
        const thoughtDisplay = document.getElementById('thought-display');
        
        function think(text, duration = 3000) {
            // Плавна зміна думок
            thoughtDisplay.style.opacity = '0';
            setTimeout(() => {
                thoughtDisplay.innerText = text;
                thoughtDisplay.style.opacity = '1';
                
                if (duration > 0) {
                    setTimeout(() => { thoughtDisplay.style.opacity = '0'; }, duration);
                }
            }, 1000);
        }

        // --- 2. ЖИТТЄВИЙ ЦИКЛ ---
        const core = document.getElementById('core');
        const ambient = document.getElementById('ambient');
        const orbits = document.getElementById('orbits');
        const worldCenter = document.getElementById('world-center');
        
        let state = 'chaos'; // chaos -> resonance -> stabilizing -> stabilized

        // ЕТАП 1: УСВІДОМЛЕННЯ КАТАСТРОФИ
        setTimeout(() => think("рівновага втрачена", 3000), 1000);
        setTimeout(() => think("матерія кричить", 3000), 5000);
        
        setTimeout(() => {
            think("потрібна точка опори", 0); // Тримаємо фразу
            orbits.style.opacity = '1';
            state = 'resonance';
        }, 9000);

        // --- 3. ВЗАЄМОДІЯ (РЕЗОНАНС) ---
        const nodes = document.querySelectorAll('.guardian-node');
        let holdTimer = null;
        
        nodes.forEach(node => {
            // Початок дотику
            node.addEventListener('touchstart', (e) => startResonance(e, node), {passive: false});
            node.addEventListener('mousedown', (e) => startResonance(e, node));
            
            // Кінець дотику
            node.addEventListener('touchend', endResonance);
            node.addEventListener('mouseup', endResonance);
            node.addEventListener('mouseleave', endResonance);
        });

        function startResonance(e, node) {
            if (state !== 'resonance') return;
            e.preventDefault();
            
            node.classList.add('active');
            
            // Візуальний фокус
            worldCenter.style.transform = 'scale(0.9)'; // Світ стискається
            core.style.transform = 'scale(0.8)'; 
            
            // Звук думок (опис ролі)
            const role = node.dataset.role;
            let thought = "";
            if (role === 'foundation') thought = "фундамент • важкість • спокій";
            if (role === 'architecture') thought = "архітектура • логіка • схема";
            if (role === 'resonance') thought = "резонанс • життя • потік";
            
            thoughtDisplay.innerText = thought;
            thoughtDisplay.style.opacity = '1';

            // Утримання для вибору
            holdTimer = setTimeout(() => {
                commitRole(role, node);
            }, 1500);
        }

        function endResonance() {
            if (state !== 'resonance') return;
            clearTimeout(holdTimer);
            
            nodes.forEach(n => n.classList.remove('active'));
            worldCenter.style.transform = 'scale(1)';
            core.style.transform = 'scale(1)';
            thoughtDisplay.style.opacity = '0';
        }

        function commitRole(role, node) {
            state = 'stabilizing';
            const color = getComputedStyle(node).color;
            
            // Ефект прийняття
            orbits.style.opacity = '0';
            orbits.style.pointerEvents = 'none';
            
            // Ядро забарвлюється в колір вибору, потім в червоний (тривога)
            core.style.boxShadow = `0 0 100px ${color}`;
            core.style.background = color;
            
            think(`ПРИЙНЯТО: ${role.toUpperCase()}`);

            setTimeout(() => {
                // Перехід до драми
                startStabilization(color);
            }, 2500);
        }

        // --- 4. СТАБІЛІЗАЦІЯ (ДРАМА ЯДРА) ---
        function startStabilization(roleColor) {
            think("УТРИМУЙ РОЗПАД");
            
            // Повертаємо тривогу, але сильнішу
            core.style.background = "#000";
            core.style.boxShadow = "0 0 40px rgba(255, 60, 60, 0.9)";
            core.style.animation = "heartbeat-panic 0.6s infinite ease-in-out"; // Швидке серцебиття
            
            // Слухаємо дотик до центру
            worldCenter.addEventListener('touchstart', onHoldStart, {passive: false});
            worldCenter.addEventListener('mousedown', onHoldStart);
            worldCenter.addEventListener('touchend', onHoldEnd);
            worldCenter.addEventListener('mouseup', onHoldEnd);
        }

        let progress = 0;
        let stabilizeInterval;

        function onHoldStart(e) {
            if (state !== 'stabilizing') return;
            e.preventDefault();
            createRipple(e);

            // Ефект зусилля
            worldCenter.style.transform = "scale(0.95)";
            
            stabilizeInterval = setInterval(() => {
                progress += 1.5;
                
                // Візуальний прогрес: Ядро світлішає і заспокоюється
                const intensity = progress / 100;
                core.style.opacity = 0.5 + (intensity * 0.5);
                ambient.style.opacity = 0.5 + (intensity * 0.5);
                
                // Тремтіння
                const shake = (1 - intensity) * 5;
                worldCenter.style.transform = `translate(${Math.random()*shake}px, ${Math.random()*shake}px) scale(0.95)`;

                if (progress >= 100) {
                    finalize();
                }
            }, 30);
        }

        function onHoldEnd() {
            if (state !== 'stabilizing') return;
            clearInterval(stabilizeInterval);
            worldCenter.style.transform = "scale(1)";
            // Якщо відпустити — відкат назад
            progress = Math.max(0, progress - 10); 
        }

        // --- 5. ФІНАЛ (ТИША) ---
        function finalize() {
            clearInterval(stabilizeInterval);
            state = 'stabilized';
            
            // 1. Прибираємо глюки
            document.body.classList.remove('broken');
            
            // 2. Змінюємо світло на стабільне
            ambient.style.background = "radial-gradient(circle, rgba(180, 255, 230, 0.2), transparent 70%)";
            ambient.style.animation = "breathe-calm 8s infinite ease-in-out";
            
            // 3. Ядро стає стабільним
            core.style.animation = "heartbeat-calm 6s infinite ease-in-out";
            core.style.boxShadow = "0 0 80px rgba(180, 255, 230, 0.5)";
            core.style.background = "#020805"; // Глибокий зелений
            worldCenter.style.transform = "scale(1)";

            // 4. Фінальна думка
            think("", 100); // Очистка
            setTimeout(() => {
                think("ти втрутився", 4000);
            }, 1000);
            
            setTimeout(() => {
                think("тепер відповідальність на тобі", 0); // Лишається назавжди
            }, 6000);
        }

        // --- УТИЛІТИ ---
        function createRipple(e) {
            const x = e.touches ? e.touches[0].clientX : e.clientX;
            const y = e.touches ? e.touches[0].clientY : e.clientY;
            const rip = document.createElement('div');
            rip.className = 'ripple';
            rip.style.left = x + 'px';
            rip.style.top = y + 'px';
            rip.style.width = '10px'; rip.style.height = '10px';
            document.body.appendChild(rip);
            setTimeout(() => rip.remove(), 1500);
        }

        // --- ЕФІРНИЙ ФОН (Оптимізований) ---
        const canvas = document.getElementById('dust-layer');
        const ctx = canvas.getContext('2d');
        let w, h;
        
        function resize() { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize);
        resize();

        const particles = Array.from({length: 60}, () => ({
            x: Math.random() * w, y: Math.random() * h,
            s: Math.random() * 1.5,
            vx: (Math.random() - 0.5) * 0.2, vy: (Math.random() - 0.5) * 0.2,
            a: Math.random() * 0.5
        }));

        function animParticles() {
            ctx.clearRect(0, 0, w, h);
            ctx.fillStyle = "#fff";
            particles.forEach(p => {
                p.x += p.vx; p.y += p.vy;
                if(p.x < 0) p.x = w; if(p.x > w) p.x = 0;
                if(p.y < 0) p.y = h; if(p.y > h) p.y = 0;
                ctx.globalAlpha = p.a;
                ctx.beginPath(); ctx.arc(p.x, p.y, p.s, 0, Math.PI*2); ctx.fill();
            });
            requestAnimationFrame(animParticles);
        }
        animParticles();

    </script>
</body>
</html>
